<html>
	<head>

		<style type="text/css">
			progress[value] {
			  /* Reset the default appearance */
			  -webkit-appearance: none;
			   appearance: none;

			  width: 250px;
			  height: 10px;
			}
			progress[value]::-webkit-progress-bar {
			  background-color: #eee;
			  border-radius: 2px;
			  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.25) inset;
			}
	    </style>


		<script type="text/javascript">
		var sockets = new Array();
		var files = new Array();
		function Open(){
			var bar =  document.getElementById("progressBar");
			var filesize = 0;
			var filecount = 0;
			var barvalue = 0;
			ws = new WebSocket("ws://1.2.4.128:80/websocket");
			ws.onopen = function(){
				console.log('Connected');
			};
			ni = document.getElementById('files_div');
			ws.onmessage = function (evt)
			{
				var received_msg = evt.data;
				//console.log("Recv: " + received_msg);
				var Count = document.getElementById('count').value;
				str = evt.data[0];
				switch (str)
				{
				case "1": 
							console.log("Recv data: " + received_msg);
							document.getElementById('count').value = parseInt(document.getElementById('count').value) + 1408;
							barvalue = barvalue + filecount;
							bar.value = barvalue;
				            break;
				case "f": 
							files.push({bar:"",size:"",name:""});
							console.log("Recv " + received_msg);
							// console.log("files!!!! " + files[0].name3);
							files[files.length-1].bar = document.createElement('progress');
							files[files.length-1].bar.setAttribute('id','pb');
							files[files.length-1].bar.setAttribute('value',0);
							files[files.length-1].name = document.createElement('span');
							files[files.length-1].name.innerHTML = evt.data.slice(6,received_msg.length-1);
							files[files.length-1].size = document.createElement('textarea');
							// files[files.length-1].size.setAttribute = ('style', 'width:10px;height:10px;font-family:cursive;border:dotted 10px #6DB72C;');
							files[files.length-1].size.style.width = "10px";
							files[files.length-1].size.style.resize = "none";
							files[files.length-1].size.style.overflow = "hidden";
							files[files.length-1].size.innerHTML = "0/0";
							ni.appendChild(files[files.length-1].bar);
							ni.appendChild(files[files.length-1].size);
							ni.appendChild(files[files.length-1].name);
							ni.appendChild(document.createElement('br'));


				            break;
				case "s": 
							console.log("Recv " + received_msg);
							files[files.length-1].bar.setAttribute('max',evt.data.slice(5,received_msg.length));
							files[files.length-1].size.innerHTML = "0/" + evt.data.slice(5,received_msg.length);
				            break;
				case "p": 
							console.log("Recv " + received_msg);
							OpenNew(received_msg.slice(5,10));
							// filesize = parseInt(received_msg.slice(5,received_msg.length));
							// filecount = 100/(filesize/1408);
							// console.log("Recv size: " + received_msg);
				            break;
				case "c": 
							console.log("Recv " + evt.data);
							
							sockets[evt.data.slice(11,16)].close();
							filesize = 0;
							filecount = 0;
							barvalue = 0;
				            break;
				default: console.log("Recv debug: " + received_msg);
				}
			};
			ws.onclose = function()
			{
				console.log('Connection closed log');
			};
		}

		function OpenNew(Port){
			
			sockets[Port] = new WebSocket("ws://1.2.4.128:80/websocket");
			sockets[Port].onopen = function(){
				console.log('Connected   to   port ' + Port);
				sockets[Port].send("11112");
			};
			sockets[Port].onmessage = function (evt)
			{
				strr = evt.data[0];
				switch (strr)
				{
				// case "1": 
				// 			console.log("Recv NEW data: " + evt.data);
				// 			// document.getElementById('count').value = parseInt(document.getElementById('count').value) + 1408;
				// 			// barvalue = barvalue + filecount;
				// 			// bar.value = barvalue;
				//    			// break;
				// 			// filesize = parseInt(received_msg.slice(5,received_msg.length));
				// 			// filecount = 100/(filesize/1408);
				// 			// console.log("Recv size: " + received_msg);
				//             break;
				// case "c": 
				// 			console.log("Recv NEW " + evt.data);
				// 			filesize = 0;
				// 			filecount = 0;
				// 			barvalue = 0;
				//             break;
				default: console.log("Recv debug port " + Port + " " + evt.data);
				}
			};
		}

		function Close() {
			ws.close();
		}

		function SendMsg()
		{
			var Msg = document.getElementById('txt').value;
			ws.send(Msg);
			console.log('Sent: ', Msg);
		}
		
		function Open_telnet(){
			ws.send("sub");
			console.log('Sent req to telnet 0.116');
		}



		</script>
	</head>
	<body>
		<div id="menu1">
			<a href="javascript:Open()">Open websocket connection</a>
			<a href="javascript:Close()">Close websocket connection</a>
			<a href="javascript:SendMsg()">SendMsg</a>
		</div>
		<input type="text" id="txt" size="120" value="11112" ></input>
		
		<div id="menu2">
			<a href="javascript:Open_telnet()">Open telnet 0.116</a>
		</div>
		
		<div id="msgs"></div>
		<input id="count" type="text" value="0"></input>
		<progress id="progressBar" value="0" max="100"></progress><br>
		<div id="files_div"><br></div>
		<textarea style="resize:none;width:130px;font-family:Consolas;font-weight:300;height:20px;overflow:hidden;">1234567/1234567</textarea>







	</body>
</html>